{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ActionBuilder = exports.Action = void 0;\n\nclass Action {\n  constructor(stages) {\n    this.stages = stages; // @ts-ignore\n\n    this.state = new Array(stages.length);\n    this.promises = new Array(stages.length);\n  }\n\n  get ids() {\n    return this.stages.map(s => s.id);\n  }\n\n  runAll() {\n    return __awaiter(this, void 0, void 0, function* () {\n      for (let i = 0; i < this.ids.length; i++) {\n        yield this.run(i);\n      }\n\n      return yield this.result;\n    });\n  }\n\n  run(idx) {\n    if (idx === 0) {\n      return this.runInternal(idx, null);\n    }\n\n    if (idx >= this.stages.length) {\n      throw new Error(`Stage with index ${idx} not found`);\n    }\n\n    const prevState = this.state[idx - 1];\n\n    if (prevState == null) {\n      throw new Error(`Stage ${idx - 1} hasn't been run yet`);\n    }\n\n    if (prevState.status !== \"resolved\") {\n      throw new Error(`Stage ${idx - 1} status is: ${prevState.status}`);\n    }\n\n    return this.runInternal(idx, prevState.value);\n  }\n\n  runInternal(idx, input) {\n    // @ts-ignore\n    const state = this.state[idx];\n\n    if (state != null && (state.status === \"pending\" || state.status === \"resolved\")) {\n      return this.promises[idx];\n    } else {\n      this.state[idx] = {\n        status: \"pending\"\n      };\n      const promise = this.stages[idx].run(input);\n      this.promises[idx] = promise;\n      promise.then(r => {\n        this.state[idx] = {\n          status: \"resolved\",\n          value: r\n        };\n        return r;\n      }).catch(err => {\n        this.state[idx] = {\n          status: \"rejected\",\n          error: err\n        };\n        return Promise.reject(err);\n      });\n      return promise;\n    }\n  }\n\n  get result() {\n    // @ts-ignore\n    return this.run(this.stages.length - 1);\n  }\n\n}\n\nexports.Action = Action;\n\nclass ActionBuilder {\n  constructor(stages) {\n    this.stages = stages;\n  }\n\n  then(stage) {\n    // @ts-ignore\n    return new ActionBuilder([...this.stages, stage]);\n  }\n\n  build() {\n    // @ts-ignore\n    return new Action(this.stages);\n  }\n\n  static create() {\n    // @ts-ignore\n    return new ActionBuilder([]);\n  }\n\n}\n\nexports.ActionBuilder = ActionBuilder;","map":{"version":3,"sources":["/home/abhishek/Code/nft-template/node_modules/@rarible/action/build/index.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","ActionBuilder","Action","constructor","stages","state","Array","length","promises","ids","map","s","id","runAll","i","run","idx","runInternal","Error","prevState","status","input","promise","r","catch","err","error","stage","build","create"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ActionBuilder = exports.Action = void 0;\nclass Action {\n    constructor(stages) {\n        this.stages = stages;\n        // @ts-ignore\n        this.state = new Array(stages.length);\n        this.promises = new Array(stages.length);\n    }\n    get ids() {\n        return this.stages.map(s => s.id);\n    }\n    runAll() {\n        return __awaiter(this, void 0, void 0, function* () {\n            for (let i = 0; i < this.ids.length; i++) {\n                yield this.run(i);\n            }\n            return yield this.result;\n        });\n    }\n    run(idx) {\n        if (idx === 0) {\n            return this.runInternal(idx, null);\n        }\n        if (idx >= this.stages.length) {\n            throw new Error(`Stage with index ${idx} not found`);\n        }\n        const prevState = this.state[idx - 1];\n        if (prevState == null) {\n            throw new Error(`Stage ${idx - 1} hasn't been run yet`);\n        }\n        if (prevState.status !== \"resolved\") {\n            throw new Error(`Stage ${idx - 1} status is: ${prevState.status}`);\n        }\n        return this.runInternal(idx, prevState.value);\n    }\n    runInternal(idx, input) {\n        // @ts-ignore\n        const state = this.state[idx];\n        if (state != null && (state.status === \"pending\" || state.status === \"resolved\")) {\n            return this.promises[idx];\n        }\n        else {\n            this.state[idx] = { status: \"pending\" };\n            const promise = this.stages[idx].run(input);\n            this.promises[idx] = promise;\n            promise\n                .then(r => {\n                this.state[idx] = { status: \"resolved\", value: r };\n                return r;\n            })\n                .catch(err => {\n                this.state[idx] = { status: \"rejected\", error: err };\n                return Promise.reject(err);\n            });\n            return promise;\n        }\n    }\n    get result() {\n        // @ts-ignore\n        return this.run(this.stages.length - 1);\n    }\n}\nexports.Action = Action;\nclass ActionBuilder {\n    constructor(stages) {\n        this.stages = stages;\n    }\n    then(stage) {\n        // @ts-ignore\n        return new ActionBuilder([...this.stages, stage]);\n    }\n    build() {\n        // @ts-ignore\n        return new Action(this.stages);\n    }\n    static create() {\n        // @ts-ignore\n        return new ActionBuilder([]);\n    }\n}\nexports.ActionBuilder = ActionBuilder;\n"]},"metadata":{},"sourceType":"script"}